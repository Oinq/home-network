server:
  name: oinqserver
  model: "HP ProLiant MicroServer Gen8"
  collected_at: "2025-11-04"

  os:
    distro: "Ubuntu 24.04.2 LTS (noble)"
    kernel: "6.8.0-85-generic"
    uptime_pretty: "up 1 week, 6 days, 23 hours, 0 minutes"

  cpu:
    model: "Intel(R) Xeon(R) CPU E3-1265L v2 @ 2.50GHz"
    sockets: 1
    cpus_logical: 8
    threads_per_core: 2

  ram:
    # dmidecode confirma 2x8 GB a 1333 MT/s
    physical: "16 GB (2 x 8 GB, 1333 MT/s)"
    os_reported_total: "15 GiB"

  gpu:
    model: "NVIDIA Quadro P400 (2 GB)"
    driver: "535.274.02"
    cuda: "12.2"
    nvenc_encoders:
      - av1_nvenc
      - h264_nvenc
      - hevc_nvenc

  storage:
    system_disk:
      device: "/dev/sde2"
      size: "59.6G"
      fs: "ext4"
      mountpoint: "/"
    array:
      md_device: "/dev/md127"
      name: "oinqserver:0"
      uuid: "9ab44b21:0c0ebabd:ab56e0fd:8d1f0a41"
      created: "2025-06-28"
      level: "raid5"
      chunk_size: "512K"
      bitmap: "internal"
      size: "8.19 TiB (9.00 TB)"
      fs: "ext4"
      mountpoint: "/mnt/raid"
      state: "clean [UUUU]"
      devices_total: 4
      members:
        - device: "/dev/sda"
          size: "2.7T"
          state: "active sync"
          model: "ST3000VX000-1CU166"
        - device: "/dev/sdb"
          size: "2.7T"
          state: "active sync"
          model: "ST3000VX000-1CU166"
        - device: "/dev/sdc"
          size: "2.7T"
          state: "active sync"
          model: "ST3000VX000-1CU166"
        - device: "/dev/sdd"
          size: "2.7T"
          state: "active sync"
          model: "ST3000VX000-1CU166"

  network:
    lan_subnet: "192.168.1.0/24"
    default_gateway: "192.168.1.1"
    interfaces:
      - name: "eno1"
        ipv4: "192.168.1.5/24"
        config_source: "dhcp (reservado no OPNsense)"
      - name: "eno2"
        ipv4: null
      - name: "tailscale0"
        ipv4: "100.126.192.110/32"
    docker_bridges:
      - "docker0 172.17.0.1/16"
      - "br-ae8cf8a84a43 172.19.0.1/16"
      - "br-f3e758bab7ac 172.18.0.1/16"

  services:
    systemd:
      ssh: "active"
      smbd: "inactive"
      nfs-server: "inactive"
    listeners:  # portas em escuta (ss -tulpn)
      - "tcp *:22"
      - "tcp *:80"
      - "tcp *:443"
      - "tcp 127.0.0.53:53"
      - "tcp *:1883"
      - "tcp *:8883"
      - "tcp *:2283"
      - "tcp *:8007"
      - "tcp *:8096"
      - "tcp *:25565"
      - "tcp *:3389"
      - "tcp 0.0.0.0:61208"
      - "udp 0.0.0.0:5353"
      - "udp 127.0.0.53:53"
      - "udp 192.168.1.5%eno1:68"

  docker:
    version: "27.5.1"
    runtimes: ["nvidia", "runc", "io.containerd.runc.v2"]
    containers:
      - name: "mc-server"
        image: "itzg/minecraft-server:latest"
        status: "Up (healthy)"
      - name: "immich_server"
        image: "ghcr.io/immich-app/immich-server:release"
        status: "Up (healthy)"
      - name: "immich_machine_learning"
        image: "ghcr.io/immich-app/immich-machine-learning:release-cuda"
        status: "Up (healthy)"
      - name: "immich_postgres"
        image: "ghcr.io/immich-app/postgres:14-vectorchord0.4.3-pgvectors0.2.0"
        status: "Up (healthy)"
      - name: "immich_redis"
        image: "valkey/valkey:8-bookworm"
        status: "Up (healthy)"
      - name: "jellyfin"
        image: "lscr.io/linuxserver/jellyfin:latest"
        status: "Up"
      - name: "bumper"
        image: "bmartin5692/bumper"
        status: "Up"

  mounts:
    nas_media:
      source: "//192.168.1.3/data/media"
      target: "/mnt/nas_media"
      fstype: "cifs"
      options: "credentials=/root/.smbcredentials,uid=1000,gid=1000,iocharset=utf8,file_mode=0777,dir_mode=0777,vers=3.0,x-systemd.automount"
      automount: true
      verified_with:
        - "mount | grep nas_media"
        - "ls -al /mnt/nas_media | head"

  smart_monitoring:
    service: "smartmontools.service"
    status: "active (running)"
    smartd_conf: 'DEVICESCAN -a -o on -S on -s (S/../.././02) -s (L/../../7/03) -W 4,45,50'
    notes:
      - "Short test diário 02:00; long test semanal (Dom) 03:00"
      - "Alertas de temperatura: Δ4°C / 45°C / 50°C"
    raid_array: "/dev/md127 clean [UUUU]"

  media_stack:
    jellyfin:
      image: "lscr.io/linuxserver/jellyfin:latest"
      ports: ["8096:8096"]
      env:
        PUID: 1000
        PGID: 1000
        TZ: "Europe/Brussels"
        NVIDIA_VISIBLE_DEVICES: "all"
        NVIDIA_DRIVER_CAPABILITIES: "compute,video,utility"
      gpus: "all"
      volumes:
        - "/mnt/raid/containers/jellyfin/config:/config"
        - "/mnt/raid/containers/jellyfin/cache:/cache"
        - "/mnt/nas_media:/media"
      verified_with:
        - "docker exec -it jellyfin nvidia-smi"
        - "/usr/lib/jellyfin-ffmpeg/ffmpeg -hide_banner -encoders | grep -i nvenc (dentro do container)"
        - "ls -al /media (dentro do container) → movies/, tv/…"
      nvenc: true
      transcode_path: "/cache/transcodes"
      validated_at: "2025-11-04T23:35"
